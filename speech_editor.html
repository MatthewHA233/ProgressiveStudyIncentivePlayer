<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>33å¨˜å°è¯ç¼–è¾‘å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #ff69b4;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #666;
            margin-bottom: 15px;
            border-bottom: 2px solid #ff69b4;
            padding-bottom: 5px;
        }
        
        .config-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .config-label {
            width: 150px;
            font-weight: bold;
        }
        
        .config-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .speech-category {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            background: #fafafa;
        }
        
        .category-header {
            background: #ff69b4;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            user-select: none;
        }
        
        .category-content {
            padding: 15px;
            display: none;
        }
        
        .category-content.active {
            display: block;
        }
        
        .speech-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            background: white;
        }
        
        .speech-header {
            background: #f8f8f8;
            padding: 8px 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .speech-content {
            padding: 12px;
        }
        
        .speech-field {
            margin-bottom: 10px;
        }
        
        .speech-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        
        .speech-field input, .speech-field textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .speech-field textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #ff69b4;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .actions {
            text-align: center;
            margin-top: 30px;
        }
        
        .actions .btn {
            margin: 0 10px;
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .add-speech-btn {
            margin-top: 10px;
        }
        
        .json-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .level-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .level-item input {
            margin: 0 5px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        
        .level-item .level-code {
            width: 60px;
            font-weight: bold;
        }
        
        .level-item .range-input {
            width: 60px;
        }
        
        .level-item .theme-input {
            flex: 1;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¾ 33å¨˜å°è¯ç¼–è¾‘å™¨ ğŸ¾</h1>
        
        <!-- é…ç½®åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">åŸºç¡€é…ç½®</div>
            <div class="config-item">
                <label class="config-label">éŸ³é¢‘è·¯å¾„:</label>
                <input type="text" class="config-input" id="audio-path" placeholder="./audio33/">
            </div>
            <div class="config-item">
                <label class="config-label">é«˜æ•ˆå°è¯æ¦‚ç‡:</label>
                <input type="number" class="config-input" id="efficient-chance" step="0.01" min="0" max="1" placeholder="0.05">
            </div>
            <div class="config-item">
                <label class="config-label">é»˜è®¤é‡å¤é—´éš”(æ¯«ç§’):</label>
                <input type="number" class="config-input" id="default-repeat-interval" placeholder="300000">
            </div>
        </div>
        
        <!-- å­¦ä¹ æ—¶é•¿ç­‰çº§é…ç½® -->
        <div class="section">
            <div class="section-title">å­¦ä¹ æ—¶é•¿ç­‰çº§é…ç½®</div>
            <div id="duration-levels">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å°è¯ç¼–è¾‘åŒºåŸŸ -->
        <div class="section">
            <div class="section-title">å°è¯ç®¡ç†</div>
            <div id="speech-categories">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions">
            <button class="btn btn-primary" onclick="loadData()">åŠ è½½æ•°æ®</button>
            <button class="btn btn-success" onclick="saveData()">ä¿å­˜æ•°æ®</button>
            <button class="btn btn-secondary" onclick="exportJson()">å¯¼å‡ºJSON</button>
            <button class="btn btn-secondary" onclick="importJson()">å¯¼å…¥JSON</button>
        </div>
        
        <!-- JSONè¾“å‡ºåŒºåŸŸ -->
        <div class="section" style="display: none;" id="json-section">
            <div class="section-title">JSONé¢„è§ˆ</div>
            <div class="json-output" id="json-output"></div>
        </div>
    </div>
    
    <script>
        let speechData = {};
        
        // åˆå§‹åŒ–é¡µé¢
        async function init() {
            // å°è¯•åŠ è½½ç°æœ‰æ•°æ®
            await loadData();
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch('./speech_data.json');
                if (response.ok) {
                    speechData = await response.json();
                    renderAll();
                    alert('æ•°æ®åŠ è½½æˆåŠŸï¼');
                } else {
                    // ä½¿ç”¨é»˜è®¤æ•°æ®ç»“æ„
                    initDefaultData();
                    renderAll();
                    alert('æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå·²åˆå§‹åŒ–é»˜è®¤æ•°æ®ç»“æ„');
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                initDefaultData();
                renderAll();
                alert('åŠ è½½å¤±è´¥ï¼Œå·²åˆå§‹åŒ–é»˜è®¤æ•°æ®ç»“æ„');
            }
        }
        
        // åˆå§‹åŒ–é»˜è®¤æ•°æ®
        function initDefaultData() {
            speechData = {
                config: {
                    audio_path: "./audio33/",
                    efficient_chance: 0.05,
                    default_repeat_interval: 300000
                },
                expressions_comments: {
                    DEFAULT: [],
                    NORMAL: [],
                    EFFICIENT: []
                },
                learning_comments: {
                    START: [],
                    LONG_SESSION: []
                },
                study_duration_levels: [
                    { range: [0, 1.5], level: "C", theme: "ç†æƒ³ã€è¿›å–" },
                    { range: [1.5, 3], level: "CC", theme: "æ¢¦æƒ³ã€æ¢¦å¢ƒ" },
                    { range: [3, 4.5], level: "CCC", theme: "æ„Ÿä¼¤ã€åšæ¯…" }
                ],
                duration_comments: {
                    C: [],
                    CC: [],
                    CCC: []
                }
            };
        }
        
        // æ¸²æŸ“æ‰€æœ‰å†…å®¹
        function renderAll() {
            renderConfig();
            renderDurationLevels();
            renderSpeechCategories();
        }
        
        // æ¸²æŸ“é…ç½®
        function renderConfig() {
            document.getElementById('audio-path').value = speechData.config?.audio_path || '';
            document.getElementById('efficient-chance').value = speechData.config?.efficient_chance || '';
            document.getElementById('default-repeat-interval').value = speechData.config?.default_repeat_interval || '';
        }
        
        // æ¸²æŸ“æ—¶é•¿ç­‰çº§
        function renderDurationLevels() {
            const container = document.getElementById('duration-levels');
            container.innerHTML = '';
            
            if (speechData.study_duration_levels) {
                speechData.study_duration_levels.forEach((level, index) => {
                    const levelDiv = document.createElement('div');
                    levelDiv.className = 'level-item';
                    levelDiv.innerHTML = `
                        <input type="text" class="level-code" value="${level.level}" onchange="updateLevel(${index}, 'level', this.value)">
                        <span>èŒƒå›´:</span>
                        <input type="number" class="range-input" step="0.5" value="${level.range[0]}" onchange="updateLevelRange(${index}, 0, this.value)">
                        <span>-</span>
                        <input type="number" class="range-input" step="0.5" value="${level.range[1]}" onchange="updateLevelRange(${index}, 1, this.value)">
                        <span>å°æ—¶</span>
                        <input type="text" class="theme-input" value="${level.theme}" onchange="updateLevel(${index}, 'theme', this.value)" placeholder="ä¸»é¢˜æè¿°">
                        <button class="btn btn-danger" onclick="removeLevel(${index})" style="margin-left: 10px;">åˆ é™¤</button>
                    `;
                    container.appendChild(levelDiv);
                });
            }
            
            // æ·»åŠ æ–°ç­‰çº§æŒ‰é’®
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-primary add-speech-btn';
            addBtn.textContent = 'æ·»åŠ ç­‰çº§';
            addBtn.onclick = addLevel;
            container.appendChild(addBtn);
        }
        
        // æ¸²æŸ“å°è¯åˆ†ç±»
        function renderSpeechCategories() {
            const container = document.getElementById('speech-categories');
            container.innerHTML = '';
            
            // è¡¨æƒ…å°è¯
            renderSpeechCategory(container, 'è¡¨æƒ…å°è¯', speechData.expressions_comments, 'expressions_comments');
            
            // å­¦ä¹ å°è¯
            renderSpeechCategory(container, 'å­¦ä¹ è¿‡ç¨‹å°è¯', speechData.learning_comments, 'learning_comments');
            
            // æ—¶é•¿å°è¯
            renderSpeechCategory(container, 'å­¦ä¹ æ—¶é•¿å°è¯', speechData.duration_comments, 'duration_comments');
        }
        
        // æ¸²æŸ“å•ä¸ªå°è¯åˆ†ç±»
        function renderSpeechCategory(container, title, data, dataKey) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'speech-category';
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'category-header';
            headerDiv.textContent = title;
            headerDiv.onclick = () => toggleCategory(categoryDiv);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'category-content';
            
            if (data) {
                Object.keys(data).forEach(key => {
                    const subCategoryDiv = document.createElement('div');
                    subCategoryDiv.innerHTML = `
                        <h4 style="margin: 15px 0 10px 0; color: #666;">${key}</h4>
                    `;
                    
                    const speeches = data[key] || [];
                    speeches.forEach((speech, index) => {
                        const speechDiv = createSpeechEditor(speech, dataKey, key, index);
                        subCategoryDiv.appendChild(speechDiv);
                    });
                    
                    // æ·»åŠ å°è¯æŒ‰é’®
                    const addBtn = document.createElement('button');
                    addBtn.className = 'btn btn-primary add-speech-btn';
                    addBtn.textContent = `æ·»åŠ ${key}å°è¯`;
                    addBtn.onclick = () => addSpeech(dataKey, key);
                    subCategoryDiv.appendChild(addBtn);
                    
                    contentDiv.appendChild(subCategoryDiv);
                });
            }
            
            categoryDiv.appendChild(headerDiv);
            categoryDiv.appendChild(contentDiv);
            container.appendChild(categoryDiv);
        }
        
        // åˆ›å»ºå°è¯ç¼–è¾‘å™¨
        function createSpeechEditor(speech, dataKey, subKey, index) {
            const speechDiv = document.createElement('div');
            speechDiv.className = 'speech-item';
            speechDiv.innerHTML = `
                <div class="speech-header">
                    <span>å°è¯ #${index + 1}</span>
                    <button class="btn btn-danger" onclick="removeSpeech('${dataKey}', '${subKey}', ${index})">åˆ é™¤</button>
                </div>
                <div class="speech-content">
                    <div class="speech-field">
                        <label>æ—¥æ–‡å°è¯:</label>
                        <textarea onchange="updateSpeech('${dataKey}', '${subKey}', ${index}, 'jp', this.value)">${speech.jp || ''}</textarea>
                    </div>
                    <div class="speech-field">
                        <label>ä¸­æ–‡å°è¯:</label>
                        <textarea onchange="updateSpeech('${dataKey}', '${subKey}', ${index}, 'zh', this.value)">${speech.zh || ''}</textarea>
                    </div>
                    <div class="speech-field">
                        <label>éŸ³é¢‘å‰ç¼€:</label>
                        <input type="text" value="${speech.audio_prefix || ''}" onchange="updateSpeech('${dataKey}', '${subKey}', ${index}, 'audio_prefix', this.value)">
                    </div>
                </div>
            `;
            return speechDiv;
        }
        
        // åˆ‡æ¢åˆ†ç±»æ˜¾ç¤º
        function toggleCategory(categoryDiv) {
            const content = categoryDiv.querySelector('.category-content');
            content.classList.toggle('active');
        }
        
        // æ›´æ–°é…ç½®
        function updateConfig() {
            if (!speechData.config) speechData.config = {};
            speechData.config.audio_path = document.getElementById('audio-path').value;
            speechData.config.efficient_chance = parseFloat(document.getElementById('efficient-chance').value) || 0.05;
            speechData.config.default_repeat_interval = parseInt(document.getElementById('default-repeat-interval').value) || 300000;
        }
        
        // æ›´æ–°ç­‰çº§
        function updateLevel(index, field, value) {
            if (!speechData.study_duration_levels[index]) return;
            speechData.study_duration_levels[index][field] = value;
        }
        
        // æ›´æ–°ç­‰çº§èŒƒå›´
        function updateLevelRange(index, rangeIndex, value) {
            if (!speechData.study_duration_levels[index]) return;
            speechData.study_duration_levels[index].range[rangeIndex] = parseFloat(value) || 0;
        }
        
        // æ·»åŠ ç­‰çº§
        function addLevel() {
            if (!speechData.study_duration_levels) speechData.study_duration_levels = [];
            speechData.study_duration_levels.push({
                range: [0, 1],
                level: "NEW",
                theme: "æ–°ä¸»é¢˜"
            });
            renderDurationLevels();
        }
        
        // åˆ é™¤ç­‰çº§
        function removeLevel(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç­‰çº§å—ï¼Ÿ')) {
                speechData.study_duration_levels.splice(index, 1);
                renderDurationLevels();
            }
        }
        
        // æ›´æ–°å°è¯
        function updateSpeech(dataKey, subKey, index, field, value) {
            if (!speechData[dataKey] || !speechData[dataKey][subKey]) return;
            if (!speechData[dataKey][subKey][index]) return;
            speechData[dataKey][subKey][index][field] = value;
        }
        
        // æ·»åŠ å°è¯
        function addSpeech(dataKey, subKey) {
            if (!speechData[dataKey]) speechData[dataKey] = {};
            if (!speechData[dataKey][subKey]) speechData[dataKey][subKey] = [];
            
            speechData[dataKey][subKey].push({
                jp: '',
                zh: '',
                audio_prefix: subKey
            });
            
            renderSpeechCategories();
        }
        
        // åˆ é™¤å°è¯
        function removeSpeech(dataKey, subKey, index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å°è¯å—ï¼Ÿ')) {
                speechData[dataKey][subKey].splice(index, 1);
                renderSpeechCategories();
            }
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            updateConfig();
            
            const jsonStr = JSON.stringify(speechData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'speech_data.json';
            a.click();
            
            URL.revokeObjectURL(url);
            alert('æ•°æ®å·²ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œè¯·å°†å…¶å¤åˆ¶åˆ°é¡¹ç›®ç›®å½•ä¸­ï¼');
        }
        
        // å¯¼å‡ºJSON
        function exportJson() {
            updateConfig();
            const jsonOutput = document.getElementById('json-output');
            const jsonSection = document.getElementById('json-section');
            
            jsonOutput.textContent = JSON.stringify(speechData, null, 2);
            jsonSection.style.display = 'block';
            jsonOutput.scrollIntoView({ behavior: 'smooth' });
        }
        
        // å¯¼å…¥JSON
        function importJson() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            speechData = JSON.parse(e.target.result);
                            renderAll();
                            alert('JSONå¯¼å…¥æˆåŠŸï¼');
                        } catch (error) {
                            alert('JSONæ ¼å¼é”™è¯¯ï¼š' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 